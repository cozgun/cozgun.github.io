<!DOCTYPE html>
<html lang="en">

<head>
  <style>
    li {
      position: relative;
      padding-left: 11px;
      margin: 0 0 3px 0;
    }
  </style>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GL Account Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
</head>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"  integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>



<body>
  <div class="container-fluid">
    <div class="row">

      <main role="main" class="col-md-12 ml-sm-auto col-lg-12 pt-3 px-4">
        <div id="main-div">
          <div class="center">
            <h1 class="display-5">Income / expense details</h1>
          </div>

          <div class="row g-2">
            <div class="col-sm-1">
              <input type="text" value="88005200" class="form-control"
                style="font-size: 14px; background-color: orange"" maxlength=" 8" id="dk" placeholder="type GL" />
            </div>
            <div class="col-1">
              <input value=2022 type="number" class="form-control"
                style="font-size: 14px; background-color: orange"" id= " year" maxlength="4" placeholder="type year" />
            </div>
            <div class="col-auto">
              <button type="button" style="font-size: 14px" class="btn btn-primary" onclick="populateExpenses(); loadExpenses('getByDkAndYear')">List
                entries</button>
            </div>
            <div class="col-sm-2">
              <input type="text" class="form-control" id="entryStatus" style="font-size: 14px; background-color: gold"
                value="Expense Monitoring Tool" />
            </div>

            <div class="col-sm-6">
              <div class="input-group mb-3 auto-center">
                <label style="font-size: 14px; width:120px" class="input-group-text" for="myInput">Search
                  another</label>
                <input style="font-size: 14px; width:140px" type="text" id="myInputExp" placeholder="GL name or number"
                  aria-label="Search">
                <button style="font-size: 14px" class="btn btn-secondary" type="button"
                  onclick="fillSelectWithExpenseAccounts('arraysExp','myInputExp')">Go</button>
                <select style="font-size: 14px; width:300px" class="form-select" id="arraysExp"></select>
                <button style="font-size: 14px" class="btn btn-secondary" id="btnOpenExpensesExp" type="button">See
                  details</button>
              </div>
            </div>
          </div>

        </div>
        <br>

        <div class="row">
          <div class="col-sm-9">
            <table id="tasks-table" class="table table-striped">
              <thead style="font-size: 12px">
                <tr>
                  <th scope="col">gl no</th>
                  <th scope="col">date</th>
                  <th scope="col">batch</th>
                  <th scope="col">gl desc.</th>
                  <th scope="col">curr</th>
                  <th scope="col">amount</th>
                  <th scope="col">narrative</th>
                  <th scope="col">tran</th>
                  <th scope="col">cost c.</th>
                  <th scope="col">actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="col-sm-3">
            <canvas id="canvasMonthly"></canvas>
            <canvas id="canvasAnnual"></canvas>
            <br>
            <div id="chartNotUpdated" class="text-center" style="background-color: yellow; font-size: 24px">
            </div>
          </div>

        </div>
    </div>
    </main>
  </div>


  <script type="text/javascript">
    //    const ipcRenderer = require('electron').ipcRenderer;
    //    function openExpenseSummary() { onclick="window.open('expenseSummary.html', '_blank', 'location=no,top=0,left=0, height=4000,width=4000,scrollbars=yes,status=yes') };
    var getId = function (id) { return document.getElementById(id); };

    document.addEventListener("DOMContentLoaded", () => {
      //      getExpenseParameters()
      loadExpenses('getByDkAndYear')
      populateExpenses()

    });

    const btnclick = document.getElementById('btnOpenExpensesExp');
    btnclick.addEventListener('click', function () {
      localStorage.setItem("sessionGlAcct", "88005200");
      $("dk").value = localStorage.getItem("sessionGlAcct").substring(0, 8);
      loadExpenses('getByDkAndYear')
      populateExpenses()
    });

    const tasksBody = document.querySelector("#tasks-table > tbody");

    function loadExpenses(sqlCriteria, getReportYear = null) {
      var mySql;
      if (sqlCriteria == "getByDkAndYear") {
        getId("entryStatus").value = "GL #" + getId("dk").value + " listed";
        //          getId("dk").value + "%" + "' AND ISLEM_TAR_NO >= " + dateNoStart('year') + " AND ISLEM_TAR_NO <= " + dateNoEnd('year') + ";";

      } else {
      }
    }


  function populateExpenses(){
      let json = [{ "DKB_HES_NO": 88005200, "myVALOR": "02-24-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-10.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "111" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-24-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-20.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "222" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-24-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-4.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "333" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-28-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "200.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "444" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-28-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-100.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "555" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-24-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-10.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "111" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-24-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-20.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "222" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-24-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-4.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "333" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-28-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "200.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "444" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-28-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-100.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "555" },{ "DKB_HES_NO": 88005200, "myVALOR": "02-24-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-10.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "111" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-24-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-20.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "222" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-24-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-4.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "333" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-28-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "200.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "444" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-28-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-100.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "555" },{ "DKB_HES_NO": 88005200, "myVALOR": "02-24-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-10.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "111" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-24-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-20.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "222" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-24-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-4.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "333" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-28-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "200.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "444" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-28-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-100.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "555" },{ "DKB_HES_NO": 88005200, "myVALOR": "02-24-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-10.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "111" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-24-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-20.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "222" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-24-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-4.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "333" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-28-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "200.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "444" }, { "DKB_HES_NO": 88005200, "myVALOR": "02-28-2022", "YBP_MUH_REF": 99, "KISA_AD": "TELEFON GİDERLERİ", "DVZ_KOD": "TRY", "": "-100.00", "ACIKL": "Telefon Hizmet Faturası", "TRAN_NAME": "DRCT", "DEPARTMAN_KODU": "555" }]
      // to clear existing table rows
      while (tasksBody.firstChild) {
        tasksBody.removeChild(tasksBody.firstChild);
      }
      //populate table
      json.forEach((row) => {
        const cells = Object.values(row);
        const tr = document.createElement("tr");
        tasksBody.appendChild(tr);
        cells.forEach((cell) => {
          const td = document.createElement("td");
          if (cells.indexOf(cell) == 5) {
            td.style.textAlign = "right";
          }
          td.textContent = cell;
          tr.appendChild(td);
        });
        let btn = document.createElement("button");
        btn.className = "btn btn-info btn-sm";
        btn.type = "submit";
        btn.style.fontSize = "12px";
        btn.style.backgroundColor = "gold";
        if (
          getId("entryStatus").value.substring(0, 5) == "Batch") {
          btn.innerHTML = "List GL";
          btn.addEventListener("click", function () {
            getId("entryStatus").value = "GL #" + row.DKB_HES_NO + " listed";
            loadExpenses('getByDkAndYear');
          populateExpenses();

          });
        }
        else {
          btn.innerHTML = "Go to batch";
          btn.addEventListener("click", function () {
            getId("entryStatus").value = "Batch #" + row.YBP_MUH_REF + " of " + row.myVALOR + " listed";
            populateExpenses2();
          });
        }
        tr.appendChild(btn);
      });
      getId("tasks-table").style.fontSize = "12px";
    }
    
    
      function populateExpenses2(){
      let json = [{"DKB_HES_NO":38001200,"myVALOR":"12-31-2021","YBP_MUH_REF":1000,"KISA_AD":"ÖDENECEK KDV","DVZ_KOD":"TRY","":"1,000.00","ACIKL":"123456 nolu fatura bedeli","TRAN_NAME":"DRCR","DEPARTMAN_KODU":""},{"DKB_HES_NO":39080000,"myVALOR":"12-31-2021","YBP_MUH_REF":1049,"KISA_AD":"SATICILARA BORÇLAR","DVZ_KOD":"TRY","":"1,000.00","ACIKL":"123456 nolu fatura bedeli","TRAN_NAME":"DRCR","DEPARTMAN_KODU":""},{"DKB_HES_NO":88005200,"myVALOR":"12-31-2021","YBP_MUH_REF":1049,"KISA_AD":"TELEFON GİDERLERİ","DVZ_KOD":"TRY","":"-1,000.00","ACIKL":"123456 nolu fatura bedeli","TRAN_NAME":"DRCR","DEPARTMAN_KODU":"9999"}]
      // to clear existing table rows
      while (tasksBody.firstChild) {
        tasksBody.removeChild(tasksBody.firstChild);
      }
      //populate table
      json.forEach((row) => {
        const cells = Object.values(row);
        const tr = document.createElement("tr");
        tasksBody.appendChild(tr);
        cells.forEach((cell) => {
          const td = document.createElement("td");
          if (cells.indexOf(cell) == 5) {
            td.style.textAlign = "right";
          }
          td.textContent = cell;
          tr.appendChild(td);
        });
        let btn = document.createElement("button");
        btn.className = "btn btn-info btn-sm";
        btn.type = "submit";
        btn.style.fontSize = "12px";
        btn.style.backgroundColor = "gold";
        if (
          getId("entryStatus").value.substring(0, 5) == "Batch") {
          btn.innerHTML = "List GL";
          btn.addEventListener("click", function () {
            getId("entryStatus").value = "GL #" + row.DKB_HES_NO + " listed";
            loadExpenses('getByDkAndYear');
            populateExpenses();
          });
        }
        else {
          btn.innerHTML = "Go to batch";
          btn.addEventListener("click", function () {
            getId("entryStatus").value = "Batch #" + row.YBP_MUH_REF + " of " + row.myVALOR + " listed";
            populateExpenses2();
          });
        }
        tr.appendChild(btn);
      });
      getId("tasks-table").style.fontSize = "12px";
    }


    var $ = function (id) { return document.getElementById(id); };

    var ctx = document.getElementById("canvasMonthly").getContext("2d");
    var myChart = new Chart(ctx, {
      // this.barchart = new Chart('canvas', {
      type: "bar",
      responsive: true,
      data: {
        labels: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"],
        datasets: [
          {
            label: "Actual",
            data: [20, 29, 36, 44, 0, 0, 0, 0, 0, 0, 0, 0],
            borderColor: "#3cba9f",
            backgroundColor: [
              "Blue",
              "Blue",
              "Blue",
              "Blue",
              "Blue",
              "Blue",
              "Blue",
              "Blue",
              "Blue",
              "Blue",
              "Blue",
            ],
            fill: true,
          },
          {
            label: "Budget",
            type: "line",
            backgroundColor: "orange",
            borderColor: "orange",
            borderWidth: 1,
            data: [30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30],
          },
        ],
      },
      options: {
        plugins: {
          title: {
            display: true,
            text: "Monthly Trends of GL 88005200",
            fontSize: 18
          }
        },
        events: ["mousemove", "mouseout", "click", "touchstart", "touchmove", "touchend"],
        legend: {
          display: true,
        },
        scales: {
          xAxes: [
            {
              display: true,
              ticks: {
                fontSize: 10,
              },
            },
          ],
          yAxes: [
            {
              display: false,
              ticks: {
                fontSize: 10,
              },
            },
          ],
        },
      },
    });

    var ctx = document.getElementById("canvasAnnual").getContext("2d");
    var annualChart = new Chart(ctx, {
      type: "bar",
      responsive: true,
      data: {
        labels: ["2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022"],
        datasets: [
          {
            label: "Actual",
            data: [41, 50, 64, 75, 81, 99, 95, 100, 120],
            borderColor: "#3cba9f",
            backgroundColor: [
              "Blue",
              "Blue",
              "Blue",
              "Blue",
              "Blue",
              "Blue",
              "Blue",
              "Blue",
              "Blue",
              "Blue",
              "Blue",
            ],
            fill: true,
          },
          {
            label: "Budget",
            backgroundColor: "orange",
            data: [45, 55, 60, 70, 89, 100, 110, 90, 110]
          }
        ],
      },
      options: {
        plugins: {
          title: {
            text: "Annual Trends of GL 88005200",
            display: true,
            fontSize: 18
          }
        },

        events: ["mousemove", "mouseout", "click", "touchstart", "touchmove", "touchend"],
        legend: {
          display: true,
        },
        scales: {
          xAxes: [
            {
              display: true,
              ticks: {
                fontSize: 10,
              },
            },
          ],
          yAxes: [
            {
              display: false,
              ticks: {
                fontSize: 10,
              },
            },
          ],
        },
      },
    });

    let GLList = ["88001000//MENKULLER BAKIM ONARIM GİDERLERİ", "88001100//GAYRİMENKULLER BAKIM ONARIM GİDERLERİ", "88001200//KİRALANAN BİNALAR BAKIM ONARIM GİDERLERİ", "88001900//DİĞER BAKIM VE ONARIM GİDERLERİ", "88002000//HİZMET ARABALARI GİDERLERİ", "88002100//GENEL TAŞIMA ARACI GİDERLERİ", "88003000//MENKULLER SİGORTA GİDERLERİ", "88003100//GAYRİMENKULLER SİGORTA GİDERLERİ", "88003200//GRUP SİGORTASI GİDERLERİ", "88003900//DİĞER SİGORTA GİDERLERİ", "88004000//ISITMA GİDERLERİ", "88004100//AYDINLATMA GİDERLERİ", "88004200//SU GİDERLERİ", "88005000//POSTA GİDERLERİ", "88005100//TELGRAF GİDERLERİ", "88005200//TELEFON GİDERLERİ", "88005300//TELEKS GİDERLERİ", "88005400//VERİ HATTI GİDERLERİ", "88005500//ON-LINE BİLGİ GİDERLERİ", "88005900//DİĞER HABERLEŞME GİDERLERİ", "88006000//GAZETE, DERGİ VE KİTAP GİDERLERİ", "88006100//MATBUA GİDERLERİ", "88006200//KIRTASİYE GİDERLERİ", "88006300//FOTOKOPİ GİDERLERİ", "88006400//KREDİ KARTLARI", "88006500//ÇEK KARNESİ", "88006600//HİSSE SENETLERİ", "88006700//DİĞER", "88007000//TELEVİZYON YOLUYLA YAPILAN REKLAM VE İLAN GİDERLERİ", "88007100//DİĞER YOLLARLA YAPILAN REKLÂM GİDERLERİ", "88007200//DİĞER YOLLARLA YAPILAN İLAN GİDERLERİ", "88200000//İŞTİRAKLER, BAĞLI ORTAKLIKLAR VE DİĞER ORTAKLIKLAR SATIŞINDAN ZARARLAR", "88200100//GAYRİMENKUL SATIŞINDAN ZARARLAR", "88200200//MENKUL SATIŞINDAN ZARARLAR", "88200900//DİĞER AKTİFLERİMİZİN SATIŞINDAN ZARARLAR"]

    function fillSelectWithExpenseAccounts(myDropDown, mySearchText) {
      var dropdown = getId(myDropDown);
      dropdown.options.length = 0;
      var searchResults = GLList.filter(word => word.includes(getId(mySearchText).value.toUpperCase()));
      for (var i = 0; i < searchResults.length; ++i) {
        dropdown[dropdown.length] = new Option(searchResults[i], searchResults[i]);
      }
    }


  </script>

</body>

</html>
