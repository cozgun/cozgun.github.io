<!DOCTYPE html>
<html lang="en">

<head>
  <style>
    div.bottomBorder {
      padding: 0px;
      border-style: solid;
      border-width: 0px 0px 1px 0px;
      /* 25px top, 10px right, 4px bottom and 35px left */
      border-color: lightgray;
    }
    div.topBottomBorder {
      padding: 10px;
      border-style: solid;
      border-width: 1px 0px 1px 0px;
      /* 25px top, 10px right, 4px bottom and 35px left */
      border-color: lightgray;
    }
    .center {
      margin: auto;
      width: 100%;
      /* border: 3px solid #73AD21; */
      padding: 10px;
    }

    h1 {
      text-align: center;
    }

    p {
      text-align: center;
    }

    /* div {text-align: center;} */
    .vertical-center {
      margin: 0;
      position: absolute;
      top: 50%;
      -ms-transform: translateY(-50%);
      transform: translateY(-50%);
    }

    li {
      position: relative;
      padding-left: 11px;
      margin: 0 0 3px 0;
    }

    div.first {
      background: rgba(226, 162, 226, 0.3);
      border-radius: 20px;
      padding: 10px; 

    }

    div.second {
      background: rgba(226, 162, 226, 0.3);
      border-radius: 20px;
  padding: 10px; 

    }

    div.third {
      background: rgba(226, 162, 226, 0.3);
      border-radius: 20px;
  padding: 10px; 

    }

    div.fourth {
      background: rgba(226, 162, 226, 0.3);
      border-radius: 20px;
      padding: 10px; 
    }
    div.fifth {
      background: rgb(241, 11, 11);
      border-radius: 20px;
      padding: 10px; 
    }
    div.sixth {
      background: rgb(6, 139, 24);
      border-radius: 20px;
      padding: 10px; 
    }

  </style>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Expense Analysis</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
</head>
<!-- <p id='pdf-path'></p> -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>

<body>

  <div class="container-fluid">
    <div class="row">

      <main role="main" class="col-md-12 ml-sm-auto col-lg-12 pt-3 px-4">
        <div id="main-div">
          <div class="col-md-12">
            <div class="center">
            <h1 id="ExpSumHeader" class="display-6"></h1>

            <div class="container">
              <!-- <div class="row ">
                <div class="col-md-3 center">
                  <div class="second">
                    <canvas id="canvasActualVsBudget"></canvas>
                  </div>
                </div>
              
                <div class="col-md-3 auto center">
                  <div class="second">
                    <canvas id="canvasStaffActualVsBudget"></canvas>
                  </div>
                </div>  
                <div class="col-md-3 auto center">
                    <div class="second">
                      <canvas id="canvasIndActualVsBudget"></canvas>
                    </div>
                </div>
                <div class="col-md-3 auto center">
                  <div class="first">
                    <canvas id="canvasDeprActualVsBudget"></canvas>
                  </div>
                </div>
              </div> -->

              <div class="row">
                <div class="col-md-6 auto center first">
                  <canvas id="canvasExpCombined"></canvas>
                </div>
              </div>

              <div class="row">
                <div class="center">
                  <!-- <h1 id= "BudVarHeader" class="display-6"></h1> -->
                  <h3 id= "BudVarHeader" style="text-align: center"></h3>
                </div>
              </div>
            </div>
  
            <div class="row">
              <div class="col-xl-6">
                <h5>Overbudgets</h5>
                <table id="variances-table" class="table">
                  <thead style="font-size: 12px">
                    <tr>
                      <th scope="col" style="text-align:left">gl no/name</th>
                      <th scope="col">actual</th>
                      <th scope="col">budget</th>
                      <th scope="col">diff.</th>
                      <!-- <th style="color:black; background-color:darkorange" scope="col">diff.</th> -->
                      <th scope="col">%</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
              <!-- <div class="col-xl-1"></div> -->
              <div class="col-xl-6">
                <h5> Underbudgets</h5>
                <table id="variances2-table" class="table">
                  <thead style="font-size: 12px">
                    <tr>
                      <th scope="col" style="text-align:left">gl no/name</th>
                      <th scope="col">budget</th>
                      <th scope="col">actual</th>
                      <th scope="col">diff.</th>
                      <!-- <th style="color:black; background-color:lightgreen" scope="col">diff.</th> -->
                      <th scope="col">%</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>

            <div class="row ">
              <div class="center">
                <h1 class="display-6">Jump to account details</h1>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 auto center">
                <div class="row">

                  <div class="input-group mb-3 auto center">
                    <label class="input-group-text" for="myInput">Type something</label>
                    <input class="form-control" type="text" id="myInput" placeholder="GL name or number"
                      aria-label="Search">
                    <button class="btn btn-outline-success" type="button"
                      onclick="fillSelectWithExpenseAccounts('arrays','myInput')">Search
                      accounts</button>
                  </div>

                  <div class="input-group mb-3">
                    <select class="form-select" id="arrays"></select>
                    <button class="btn btn-outline-success" id="btnOpenExpenses" type="button">See details</button>
                  </div>
                </div>
              </div>
            </div>

          </div>
          <br>


        </div>
    </div>
    </main>
  </div>


  <script>
    var $ = function (id) { return document.getElementById(id); };

var barChartDataCombined = {
  labels: ["Admin", "Staff", "Indirect", "Depreciation"],
  datasets: [
    {
      label: 'Actual',
      data: [800, 950, 900, 150],
      backgroundColor: "blue"
    },
    {
      label: 'Budget',
      data: [820, 1000, 700, 180],
      backgroundColor: "orange"
    }
  ],
};
var ctx = document.getElementById("canvasExpCombined").getContext("2d");
var actualVsBudget = new Chart(ctx, {
  type: 'bar',
  data: barChartDataCombined,
  axisX:{
    labelFontSize: 10
  },
  options: {
    plugins: {
      legend: {
        position: 'top',
      },
      title: {
        fontSize: 16,
        text: "Admin",
        display: false,
        font: {
          size: 13
        }
      },

    },
    responsive: true,
  }
});

// *********************************************    
    
        var getId = function (id) { return document.getElementById(id); };
    document.addEventListener("DOMContentLoaded", () => {
//      getGLList();
//      budgetVariances();
      document.getElementById("BudVarHeader").textContent =  "Actual vs Budget Comparison Details for Admin Expenses as of 30.04.2022" 
      document.getElementById("ExpSumHeader").textContent =  "YTD Actual vs Budgets as of 30.04.2022" 
    });

    // include the ipc module to communicate with main process.
//    const ipcRenderer = require('electron').ipcRenderer;
    const btnclick = document.getElementById('btnOpenExpenses');
    btnclick.addEventListener('click', function () {
              localStorage.setItem("sessionGlAcct", "88005200");
              window.open('expense.html', '_blank', 'location=no,top=0,left=0, height=4000,width=4000,scrollbars=yes,status=yes');
    });

    const variancesBody = document.querySelector("#variances-table > tbody");
    const variances2Body = document.querySelector("#variances2-table > tbody");
    
    function populateVariances(json) {
      while (variancesBody.firstChild) {
        variancesBody.removeChild(variancesBody.firstChild);
      }
      json.forEach((row) => {
        const cells = Object.values(row);
        const tr = document.createElement("tr");
        variancesBody.appendChild(tr);
        cells.forEach((cell) => {
          const td = document.createElement("td");
          if (cells.indexOf(cell) == 0) {
            td.style.textAlign = "left";
          }
          if (cells.indexOf(cell) == 4) {
            td.textContent = "%" + cell;
          }
          else if (cells.indexOf(cell) == 0) {
            let btn = document.createElement("input");
            btn.type = "button";
            btn.className = "btn btn-outline-danger btn-sm";
            btn.style.fontSize = "12px";
            btn.value = cell;
            btn.addEventListener("click", function () {
              localStorage.setItem("sessionGlAcct", "88005200");
              window.open('expense.html', '_blank', 'location=no,top=0,left=0, height=4000,width=4000,scrollbars=yes,status=yes');
            });
            td.appendChild(btn);
          }
          else {
            td.textContent = cell;
          }
          // if (cells.indexOf(cell) == 3) {
          //   td.style.backgroundColor = "DarkOrange";
          //   td.style.color = "black";
          // }
          tr.appendChild(td);
        });
      });
      getId("variances-table").style.fontSize = "12px";
    }

    function populateVariances2(json) {
      while (variances2Body.firstChild) {
        variances2Body.removeChild(variances2Body.firstChild);
      }
      json.forEach((row) => {
        const cells = Object.values(row);
        const tr = document.createElement("tr");
        variances2Body.appendChild(tr);
        cells.forEach((cell) => {
          const td = document.createElement("td");
          if (cells.indexOf(cell) == 0) {
            td.style.textAlign = "left";
          }
          if (cells.indexOf(cell) == 4) {
            td.textContent = "%" + cell;
          }
          else if (cells.indexOf(cell) == 0) {
            let btn = document.createElement("input");
            btn.type = "button";
            btn.className = "btn btn-outline-success btn-sm";
            btn.style.fontSize = "12px";
            btn.value = cell;
            btn.addEventListener("click", function () {
              localStorage.setItem("sessionGlAcct", "88005200");
              window.open('expense.html', '_blank', 'location=no,top=0,left=0, height=4000,width=4000,scrollbars=yes,status=yes');
            });
            td.appendChild(btn);
          }
          else {
            td.textContent = cell;
          }

          tr.appendChild(td);
        });
      });
      getId("variances2-table").style.fontSize = "12px";
    }

    let overBudgetToShow = [{"dk":"83003200/ÇEVRE TEMİZLİK VERGİSİ","amount":1.5,"budg":0.3,"amountOverBudget":1.2,"overBudgetPercentage":400},{"dk":"83004000/DAMGA VERGİSİ","amount":15.72,"budg":7.8,"amountOverBudget":7.9,"overBudgetPercentage":102},{"dk":"83005000/NOTER HARÇ VE TESCİL MASRAFLARI","amount":9,"budg":3.4,"amountOverBudget":5.6,"overBudgetPercentage":165},{"dk":"88004000/ISITMA GİDERLERİ","amount":40.00,"budg":25,"amountOverBudget":15,"overBudgetPercentage":60},{"dk":"88004100/AYDINLATMA GİDERLERİ-TÜKETİM","amount":55.7,"budg":45,"amountOverBudget":10.7,"overBudgetPercentage":24},{"dk":"88006200/KIRTASİYE  GİDERLERİ","amount":6.05,"budg":4,"amountOverBudget":2.1,"overBudgetPercentage":51},{"dk":"88007200/PAZARLAMA GİDERLERİ","amount":11.48,"budg":9,"amountOverBudget":2.5,"overBudgetPercentage":28},{"dk":"88013001/ÖZEL İLETİŞİM VERGİSİ","amount":15.88,"budg":13.5,"amountOverBudget":2.4,"overBudgetPercentage":18},{"dk":"88205107/İŞYERİ HEKİMLİĞİ & İŞ GÜVENLİĞİ UZM.HİZMETLERİ","amount":0.9,"budg":0.7,"amountOverBudget":0.2,"overBudgetPercentage":61},{"dk":"88299000/GEÇMİŞ YILLARA AİT  DİĞER GİDERLER","amount":16.33,"budg":6.7,"amountOverBudget":9.6,"overBudgetPercentage":144},{"dk":"88399902/ÜYELİK GİDERLERİ-DİĞER","amount":4.00,"budg":3.2,"amountOverBudget":0.8,"overBudgetPercentage":25}]
    
    let underBudgetToShow= [{"dk":"83005001/NOTER HARÇ VE TESCİL MASRAFLARI","amount":16.7,"budg":5.77,"amountUnderBudget":10.9,"underBudgetPercentage":189},{"dk":"88002104/TAKSİ GİDERLERİ","amount":1.2,"budg":0.42,"amountUnderBudget":0.8,"underBudgetPercentage":186},{"dk":"88004200/SU GİDERLERİ","amount":1,"budg":0.11,"amountUnderBudget":1.6,"underBudgetPercentage":1445},{"dk":"88005000/POSTA GİDERLERİ","amount":6,"budg":0.21,"amountUnderBudget":6.5,"underBudgetPercentage":3090},{"dk":"88005007/KURYE GİDERLERİ","amount":3,"budg":2.68,"amountUnderBudget":0.6,"underBudgetPercentage":23},{"dk":"88008000/KÜÇÜK DEMİRBAŞ GİDERLERİ","amount":15,"budg":0.37,"amountUnderBudget":14.6,"underBudgetPercentage":3954},{"dk":"88012002/TEMSİL AĞIRLAMA GİDERLER-MOTİVASYON","amount":5,"budg":3.26,"amountUnderBudget":6.7,"underBudgetPercentage":207},{"dk":"88099901/TERCÜME GİDERİ","amount":13,"budg":3.71,"amountUnderBudget":9.7,"underBudgetPercentage":261}]
    
          populateVariances(overBudgetToShow.sort(function (a, b) { return b.amountOverBudget - a.amountOverBudget }));
          populateVariances2(underBudgetToShow.sort(function (a, b) { return b.amountUnderBudget - a.amountUnderBudget }));

    
let GLList = ["88001000//MENKULLER BAKIM ONARIM GİDERLERİ","88001100//GAYRİMENKULLER BAKIM ONARIM GİDERLERİ","88001200//KİRALANAN BİNALAR BAKIM ONARIM GİDERLERİ","88001900//DİĞER BAKIM VE ONARIM GİDERLERİ","88002000//HİZMET ARABALARI GİDERLERİ","88002100//GENEL TAŞIMA ARACI GİDERLERİ","88003000//MENKULLER SİGORTA GİDERLERİ","88003100//GAYRİMENKULLER SİGORTA GİDERLERİ","88003200//GRUP SİGORTASI GİDERLERİ","88003900//DİĞER SİGORTA GİDERLERİ","88004000//ISITMA GİDERLERİ","88004100//AYDINLATMA GİDERLERİ","88004200//SU GİDERLERİ","88005000//POSTA GİDERLERİ","88005100//TELGRAF GİDERLERİ","88005200//TELEFON GİDERLERİ","88005300//TELEKS GİDERLERİ","88005400//VERİ HATTI GİDERLERİ","88005500//ON-LINE BİLGİ GİDERLERİ","88005900//DİĞER HABERLEŞME GİDERLERİ","88006000//GAZETE, DERGİ VE KİTAP GİDERLERİ","88006100//MATBUA GİDERLERİ","88006200//KIRTASİYE GİDERLERİ","88006300//FOTOKOPİ GİDERLERİ","88006400//KREDİ KARTLARI","88006500//ÇEK KARNESİ","88006600//HİSSE SENETLERİ","88006700//DİĞER","88007000//TELEVİZYON YOLUYLA YAPILAN REKLAM VE İLAN GİDERLERİ","88007100//DİĞER YOLLARLA YAPILAN REKLÂM GİDERLERİ","88007200//DİĞER YOLLARLA YAPILAN İLAN GİDERLERİ","88200000//İŞTİRAKLER, BAĞLI ORTAKLIKLAR VE DİĞER ORTAKLIKLAR SATIŞINDAN ZARARLAR","88200100//GAYRİMENKUL SATIŞINDAN ZARARLAR","88200200//MENKUL SATIŞINDAN ZARARLAR","88200900//DİĞER AKTİFLERİMİZİN SATIŞINDAN ZARARLAR"]    
function fillSelectWithExpenseAccounts(myDropDown, mySearchText) {
  var dropdown = getId(myDropDown);
  dropdown.options.length = 0;
  var searchResults = GLList.filter(word => word.includes(getId(mySearchText).value.toUpperCase()));
  for (var i = 0; i < searchResults.length; ++i) {
    dropdown[dropdown.length] = new Option(searchResults[i], searchResults[i]);
  }
}

  </script>
</body>

</html>
